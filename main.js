(()=>{"use strict";function e(e,t){var n="error-"+e.id;document.getElementById(n).textContent="",e.classList.remove(t.inputErrorClass)}function t(e,t){e.checkValidity()?function(e){e.disabled=!1}(t):function(e){e.disabled=!0}(t)}function n(n,o){var r=n.querySelectorAll(o.inputSelector),c=n.querySelector(o.submitButtonSelector);t(n,c),r.forEach((function(t){e(t,o)}))}function o(e,t,n,o,r,c,u){var i=n.cloneNode(!0),a=i.querySelector(".element__image");a.setAttribute("src",e.link),a.setAttribute("alt",e.name),a.addEventListener("click",(function(){return o(e.name,e.link)})),i.querySelector(".element__title").textContent=e.name;var s=i.querySelector(".element__trash");e.owner._id===t?s.addEventListener("click",(function(){r(e._id).then((function(){i.remove()})).catch((function(e){console.log(e)}))})):s.remove();var l=i.querySelector(".element__heart"),p=i.querySelector(".element__likes-counter");return e.likes.find((function(e){return e._id===t}))&&l.classList.add("element__heart_active"),p.textContent=e.likes.length,l.addEventListener("click",(function(){e.likes.find((function(e){return e._id===t}))?u(e._id).then((function(t){e=t,l.classList.remove("element__heart_active"),p.textContent=e.likes.length})).catch((function(e){console.log(e)})):c(e._id).then((function(t){e=t,l.classList.add("element__heart_active"),p.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),i}function r(e){"Escape"===e.key&&u(document.querySelector(".popup_opened"))}function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r)}function u(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}var i={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-14",headers:{authorization:"fde4e83c-bd10-4364-bb0f-d13837b34264","Content-Type":"application/json"}},a=function(e){return fetch("".concat(i.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},s=function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},l=function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error"},d=document.querySelector(".element-template").content.querySelector(".element"),_=document.querySelector(".elements"),f=document.querySelectorAll(".popup"),m=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-place"),y=document.querySelector(".popup_type_update-avatar"),v=document.querySelector(".popup_type_image"),S=document.querySelector(".profile__add-button"),b=h.querySelector(".popup__form"),q=b.querySelector(".popup__input_type_place"),k=b.querySelector(".popup__input_type_link"),E=b.querySelector(".popup__button"),C=document.querySelector(".profile__edit-button"),g=m.querySelector(".popup__form"),L=g.querySelector(".popup__input_type_name"),x=g.querySelector(".popup__input_type_about"),j=g.querySelector(".popup__button"),A=document.querySelector(".profile__name"),P=document.querySelector(".profile__description"),U=document.querySelector(".profile__picture-edit-button"),T=y.querySelector(".popup__form"),w=T.querySelector(".popup__input_type_link"),B=T.querySelector(".popup__button"),D=document.querySelector(".profile__picture"),N="";function O(e,t){var n=v.querySelector(".popup__image"),o=v.querySelector(".popup__image-caption");n.setAttribute("src",t),n.setAttribute("alt",e),o.textContent=e,c(v)}function J(e){_.prepend(e)}fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e),N=e._id,A.textContent=e.name,P.textContent=e.about,D.setAttribute("src",e.avatar)})).catch((function(e){console.log(e)})),fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e),e.reverse().forEach((function(e){J(o(e,N,d,O,a,s,l))}))})).catch((function(e){console.log(e)})),S.addEventListener("click",(function(){n(b,p),c(h)})),C.addEventListener("click",(function(){L.value=A.textContent,x.value=P.textContent,n(g,p),c(m)})),U.addEventListener("click",(function(){n(T,p),c(y)})),f.forEach((function(e){e.querySelector(".popup__close-button").addEventListener("click",(function(){return u(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&u(e)}))})),g.addEventListener("submit",(function(e){var t,n;e.preventDefault(),j.textContent="Сохранение...",(t=L.value,n=x.value,fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){A.textContent=e.name,P.textContent=e.about,u(m),j.textContent="Сохраненить"})).catch((function(e){console.log(e),j.textContent="Сохраненить"}))})),b.addEventListener("submit",(function(e){var t,n;e.preventDefault(),E.textContent="Сохранение...",(t=q.value,n=k.value,fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e),J(o(e,N,d,O,a,s,l)),u(h),b.reset(),E.textContent="Сохраненить"})).catch((function(e){console.log(e),E.textContent="Сохраненить"}))})),T.addEventListener("submit",(function(e){var t;e.preventDefault(),B.textContent="Сохранение...",(t=w.value,fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){D.setAttribute("src",e.avatar),u(y),B.textContent="Сохраненить"})).catch((function(e){console.log(e),B.textContent="Сохраненить"}))})),function(n){document.querySelectorAll(n.formSelector).forEach((function(o){var r=o.querySelectorAll(n.inputSelector),c=o.querySelector(n.submitButtonSelector);t(o,c),r.forEach((function(r){r.addEventListener("input",(function(){(function(t,n){t.validity.valid?e(t,n):function(e,t,n){var o="error-"+e.id;document.getElementById(o).textContent=t,e.classList.add(n.inputErrorClass)}(t,t.validationMessage,n)})(r,n),t(o,c)}))}))}))}(p)})();
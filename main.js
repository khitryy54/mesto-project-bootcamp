(()=>{"use strict";function e(e,t){var n="error-"+e.id;document.getElementById(n).textContent="",e.classList.remove(t.inputErrorClass)}function t(e,t){e.checkValidity()?function(e){e.disabled=!1}(t):function(e){e.disabled=!0}(t)}function n(n,o){var r=n.querySelectorAll(o.inputSelector),c=n.querySelector(o.submitButtonSelector);t(n,c),r.forEach((function(t){e(t,o)}))}function o(e,t,n,o,r,c,u){var i=n.cloneNode(!0),a=i.querySelector(".element__image");a.setAttribute("src",e.link),a.setAttribute("alt",e.name),a.addEventListener("click",(function(){return o(e.name,e.link)})),i.querySelector(".element__title").textContent=e.name;var l=i.querySelector(".element__trash");e.owner._id===t?l.addEventListener("click",(function(){r(e._id).then((function(){i.remove()})).catch((function(e){console.log(e)}))})):l.remove();var s=i.querySelector(".element__heart"),p=i.querySelector(".element__likes-counter");return e.likes.find((function(e){return e._id===t}))&&s.classList.add("element__heart_active"),p.textContent=e.likes.length,s.addEventListener("click",(function(){e.likes.find((function(e){return e._id===t}))?u(e._id).then((function(t){e=t,s.classList.remove("element__heart_active"),p.textContent=e.likes.length})).catch((function(e){console.log(e)})):c(e._id).then((function(t){e=t,s.classList.add("element__heart_active"),p.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),i}function r(e){"Escape"===e.key&&u(document.querySelector(".popup_opened"))}function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r)}function u(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}var i={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-14",headers:{authorization:"fde4e83c-bd10-4364-bb0f-d13837b34264","Content-Type":"application/json"}},a=function(e){return fetch("".concat(i.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:i.headers}).then(p)},l=function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then(p)},s=function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then(p)};function p(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error"},_=document.querySelector(".element-template").content.querySelector(".element"),f=document.querySelector(".elements"),m=document.querySelectorAll(".popup"),h=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_new-place"),v=document.querySelector(".popup_type_update-avatar"),S=document.querySelector(".popup_type_image"),b=document.querySelector(".profile__add-button"),q=y.querySelector(".popup__form"),E=q.querySelector(".popup__input_type_place"),C=q.querySelector(".popup__input_type_link"),g=q.querySelector(".popup__button"),k=document.querySelector(".profile__edit-button"),L=h.querySelector(".popup__form"),x=L.querySelector(".popup__input_type_name"),A=L.querySelector(".popup__input_type_about"),U=L.querySelector(".popup__button"),T=document.querySelector(".profile__name"),w=document.querySelector(".profile__description"),B=document.querySelector(".profile__picture-edit-button"),D=v.querySelector(".popup__form"),P=D.querySelector(".popup__input_type_link"),N=D.querySelector(".popup__button"),O=document.querySelector(".profile__picture"),j="";function J(e,t){var n=S.querySelector(".popup__image"),o=S.querySelector(".popup__image-caption");n.setAttribute("src",t),n.setAttribute("alt",e),o.textContent=e,c(S)}function H(e){f.prepend(e)}fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then(p).then((function(e){console.log(e),j=e._id,T.textContent=e.name,w.textContent=e.about,O.setAttribute("src",e.avatar)})).catch((function(e){console.log(e)})),fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then(p).then((function(e){console.log(e),e.reverse().forEach((function(e){H(o(e,j,_,J,a,l,s))}))})).catch((function(e){console.log(e)})),b.addEventListener("click",(function(){n(q,d),c(y)})),k.addEventListener("click",(function(){x.value=T.textContent,A.value=w.textContent,n(L,d),c(h)})),B.addEventListener("click",(function(){n(D,d),c(v)})),m.forEach((function(e){e.querySelector(".popup__close-button").addEventListener("click",(function(){return u(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&u(e)}))})),L.addEventListener("submit",(function(e){var t,n;e.preventDefault(),U.textContent="Сохранение...",(t=x.value,n=A.value,fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:t,about:n})}).then(p)).then((function(e){T.textContent=e.name,w.textContent=e.about,u(h),U.textContent="Сохраненить"})).catch((function(e){console.log(e),U.textContent="Сохраненить"}))})),q.addEventListener("submit",(function(e){var t,n;e.preventDefault(),g.textContent="Сохранение...",(t=E.value,n=C.value,fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:t,link:n})}).then(p)).then((function(e){console.log(e),H(o(e,j,_,J,a,l,s)),u(y),q.reset(),g.textContent="Сохраненить"})).catch((function(e){console.log(e),g.textContent="Сохраненить"}))})),D.addEventListener("submit",(function(e){var t;e.preventDefault(),N.textContent="Сохранение...",(t=P.value,fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then(p)).then((function(e){O.setAttribute("src",e.avatar),u(v),N.textContent="Сохраненить"})).catch((function(e){console.log(e),N.textContent="Сохраненить"}))})),function(n){document.querySelectorAll(n.formSelector).forEach((function(o){var r=o.querySelectorAll(n.inputSelector),c=o.querySelector(n.submitButtonSelector);t(o,c),r.forEach((function(r){r.addEventListener("input",(function(){(function(t,n){t.validity.valid?e(t,n):function(e,t,n){var o="error-"+e.id;document.getElementById(o).textContent=t,e.classList.add(n.inputErrorClass)}(t,t.validationMessage,n)})(r,n),t(o,c)}))}))}))}(d)})();
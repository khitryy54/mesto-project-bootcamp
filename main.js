(()=>{"use strict";function e(e,t){var n="error-"+e.id;document.getElementById(n).textContent="",e.classList.remove(t.inputErrorClass)}function t(e){e.disabled=!0}function n(e,n){e.checkValidity()?function(e){e.disabled=!1}(n):t(n)}function r(e,t,n,r,o,c,u){var i=n.cloneNode(!0),a=i.querySelector(".element__image");a.setAttribute("src",e.link),a.setAttribute("alt",e.name),a.addEventListener("click",(function(){return r(e.name,e.link)})),i.querySelector(".element__title").textContent=e.name;var l=i.querySelector(".element__trash");e.owner._id===t?l.addEventListener("click",(function(){o(e._id).then((function(){i.remove()})).catch((function(e){console.log(e)}))})):l.remove();var s=i.querySelector(".element__heart"),d=i.querySelector(".element__likes-counter");return e.likes.find((function(e){return e._id===t}))&&s.classList.add("element__heart_active"),d.textContent=e.likes.length,s.addEventListener("click",(function(){e.likes.find((function(e){return e._id===t}))?u(e._id).then((function(t){e=t,s.classList.remove("element__heart_active"),d.textContent=e.likes.length})).catch((function(e){console.log(e)})):c(e._id).then((function(t){e=t,s.classList.add("element__heart_active"),d.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),i}function o(e){"Escape"===e.key&&u(document.querySelector(".popup_opened"))}function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o)}function u(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o)}var i={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-14",headers:{authorization:"fde4e83c-bd10-4364-bb0f-d13837b34264","Content-Type":"application/json"}},a=function(e){return fetch("".concat(i.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:i.headers}).then(d)},l=function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then(d)},s=function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then(d)};function d(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error"},_=document.querySelector(".element-template").content.querySelector(".element"),m=document.querySelector(".elements"),y=document.querySelectorAll(".popup"),h=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-place"),b=document.querySelector(".popup_type_update-avatar"),S=document.querySelector(".popup_type_image"),q=S.querySelector(".popup__image"),E=S.querySelector(".popup__image-caption"),k=document.querySelector(".profile__add-button"),C=document.forms["new-place"],L=C.querySelector(".popup__input_type_place"),g=C.querySelector(".popup__input_type_link"),x=C.querySelector(".popup__button"),A=document.querySelector(".profile__edit-button"),w=document.forms["edit-profile"],U=w.querySelector(".popup__input_type_name"),j=w.querySelector(".popup__input_type_about"),O=w.querySelector(".popup__button"),T=document.querySelector(".profile__name"),P=document.querySelector(".profile__description"),B=document.querySelector(".profile__picture-edit-button"),D=document.forms["avatar-link"],I=D.querySelector(".popup__input_type_link"),N=D.querySelector(".popup__button"),J=document.querySelector(".profile__picture"),H="";function M(e,t){q.setAttribute("src",t),q.setAttribute("alt",e),E.textContent=e,c(S)}function z(e){m.prepend(e)}Promise.all([fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then(d),fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then(d)]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,u,i=[],a=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);a=!0);}catch(e){l=!0,o=e}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],u=o[1];H=c._id,T.textContent=c.name,P.textContent=c.about,J.setAttribute("src",c.avatar),u.reverse().forEach((function(e){z(r(e,H,_,M,a,l,s))}))})).catch(console.error),k.addEventListener("click",(function(){c(v)})),A.addEventListener("click",(function(){U.value=T.textContent,j.value=P.textContent,function(t,r){var o=t.querySelectorAll(r.inputSelector),c=t.querySelector(r.submitButtonSelector);n(t,c),o.forEach((function(t){e(t,r)}))}(w,f),c(h)})),B.addEventListener("click",(function(){c(b)})),y.forEach((function(e){e.querySelector(".popup__close-button").addEventListener("click",(function(){return u(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&u(e)}))})),w.addEventListener("submit",(function(e){var t,n;e.preventDefault(),O.textContent="Сохранение...",(t=U.value,n=j.value,fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:t,about:n})}).then(d)).then((function(e){T.textContent=e.name,P.textContent=e.about,u(h)})).catch(console.error).finally((function(){O.textContent="Сохранить"}))})),C.addEventListener("submit",(function(e){var t,n;e.preventDefault(),x.textContent="Сохранение...",(t=L.value,n=g.value,fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:t,link:n})}).then(d)).then((function(e){z(r(e,H,_,M,a,l,s)),u(v),C.reset()})).catch(console.error).finally((function(){x.textContent="Сохранить"}))})),D.addEventListener("submit",(function(e){var t;e.preventDefault(),N.textContent="Сохранение...",(t=I.value,fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then(d)).then((function(e){J.setAttribute("src",e.avatar),u(b)})).catch(console.error).finally((function(){N.textContent="Сохранить"}))})),function(r){document.querySelectorAll(r.formSelector).forEach((function(o){var c=o.querySelectorAll(r.inputSelector),u=o.querySelector(r.submitButtonSelector);n(o,u),o.addEventListener("reset",(function(){t(u)})),c.forEach((function(t){t.addEventListener("input",(function(){(function(t,n){t.validity.valid?e(t,n):function(e,t,n){var r="error-"+e.id;document.getElementById(r).textContent=t,e.classList.add(n.inputErrorClass)}(t,t.validationMessage,n)})(t,r),n(o,u)}))}))}))}(f)})();